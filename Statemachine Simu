/*Mike hat spaß an c*/
#include <stdio.h>
#include <stdlib.h>

#define BLAL 0 // 00
#define BLAH 1 // 01
#define BHAH 2 // 11
#define BHAL 3 // 10

/**
GrayCode
  |B | A | State
  |--|---|------
0 |0 | 0 |  1
1 |0 | 1 |  2
2 |1 | 1 |  3
3 |1 | 0 |  4
**/
/**
Wichtig für die Aufgabe Sind nur die Statemachine und der Rumpf der do while Schleife
**/
int state;
int bita=0;
int bitb=0;
int counter=0;

void stateMachine()
{

    switch( (state) )
    {
    //00
    case BLAL:
        if (bitb==0 && bita==1)
        {
            counter++;
            state = BLAH;
        }
        else if (bitb==1 && bita==0)
        {
            counter--;
            state = BHAL;
        }
        break;
    //01
    case BLAH:
        if (bitb==1 && bita==1)
        {
            counter++;
            state = BHAH;
        }
        else if (bitb==0 && bita==0)
        {
            counter--;
            state = BLAL;
        }
        break;
    //11
    case BHAH:
        if (bitb==1 && bita==0)
        {
            counter++;
            state = BHAL;
        }
        else if (bitb==0 && bita==1)
        {
            counter--;
            state = BLAH;
        }
        break;
    //10
    case BHAL:
        if (bitb==0 && bita==0)
        {
            counter++;
            state = BLAL;
        }
        else if (bitb==1 && bita==1)
        {
            counter--;
            state = BHAH;
        }
        break;
    }
   // printf(" State: %i ,Count: %i\n",state,counter);

}

void printMenue()
{
    printf("Der Statemaschiene Drehgebe Simulator 2017 v.1\n");
    printf("Menue\n");
    printf("Bits: BA\n");
    printf("\n'a'=00");
    printf("\n's'=01");
    printf("\n'd'=11");
    printf("\n'f'=10\n");
    printf("\n'm'=Print Menue");
    printf("'e'= exit: \n");
    printf("--------------\n");
    return ;
}
int main()
{
    //Setup()
    state = 3;//welchen State ist eigendlich egal
    counter =0; // Das ist der zähler
    int A=0;


    //loop
    printMenue();
    do
    {
        A = getchar();

        //nur für Die Benutzerfreundlichkeit
        if(A=='m')
            printMenue();
        //Nach dem getchar bleibt immer noch nen \n deswegen hatte der das immer
        //doppelt geprintet
        if (A!= '\n')
            printf(" State: %i ,Count: %i\n LastCommand: '%c'\n",state,counter,A);

        //'a'=00 | 's'=01 | 'd'=11 | 'f'=10
        if (A=='a')
        {
            bita=bitb=0;
        }
        else if (A=='s')
        {
            bitb=0;
            bita=1;
        }
        else if (A=='d')
        {
            bitb=1;
            bita=1;
        }
        else if (A=='f')
        {
            bitb=1;
            bita=0;
        }
        stateMachine();

    }while((A !='e'));
    printf("Danke und Aufwiedersehen\n");
    getchar();
    return 0;
}
